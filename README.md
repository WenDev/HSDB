# HSDB - 一个听着Hardstyle写出来的SQL解析器

> 小声：其实写的时候除了Hardstyle也会听Big Room House啦。。。

这是本人——一个想成为Gopher的Kotlin民工的第一个Go语言项目。因为实验要求没有规定用什么语言来写，所以Go语言是一个比较好的选择——因为我只有不到五天的时间啊，当然是啥语言写起来短就用什么了（哭

别问我前几周干嘛去了，刚经历过操作系统考试洗礼的我表示刚想喘口气就又掉进另一个大坑了。

一切思路都会以时间为标题在这个README里记录下来，方便后来的同学参考。

## 2020-12-21

开始撸代码。

找了一些SQL解析器的文章，为了搞懂客户端和服务端之间的通信问题又看了一个聊天室的项目。

说是要做一个数据库，其实是做一个功能丰富点的SQL解析器罢了。底层数据存储选择了CSV，能用CSV的就不用别的数据结构。CSV对于经常打数学建模的我来说是一种很熟悉的数据格式了，不仅好解析还十分易懂。老师推荐的数据格式是DBF，但是查了一下感觉过于复杂了，也没啥比较好的第三方库可以用，对于一个要在五天之内做出来的系统来说用这种结构不太现实。基于txt之类的自己设计结构也不现实，还得自己写这种结构的解析器，还是用CSV这种现成的吧，毕竟Go语言可是提供了CSV解析器的啊，放着不用不就浪费了嘛。

数据类型初步考虑用枚举全部定义好，到时候读写、解析直接以枚举类型为准。

> 我知道Go没有真正意义上的枚举，都是用const和iota模拟的，但是我这么叫叫习惯了，所以忽略这些细节吧……

索引初步考虑用B+树，毕竟MySQL就是这么干的，但是也可能会改。

选做四选二（帮助信息、索引更新、权限、代数优化）打算做帮助信息和权限，问就是五天内做得出来。

不多说了，开工。

### 20:20

参考[https://github.com/marianogappa/sqlparser](https://github.com/marianogappa/sqlparser)这个Go语言的SQL解析器定义了一下SQL语句的类型（增删改查，Create，Drop，Grant，Revoke等等），位于`parser.go`。不过还没写数据类型定义。

先把CSV读写的部分写出来吧。

HSDB的存储结构如下：

一张表对应一个CSV文件（用户相关的待定），第一行为字段名，第二行为类型定义，第三行为约束条件，第四行及以后为具体数据。

### 21：52

写了一个多小时，定义了一些数据结构，包括表、列、元组、数据类型、约束、Where字句的连接符号（And，In，Like）等，位于`data_type.go`和`table.go`。

把增删改查数据的函数定义先写好了，具体功能再结合CSV读写做实现。

今天先写到这，脑子有点懵，估计再写下去就要写出bug了……

## 2020-12-23

昨天休息了一天，今天继续干。

今天把建表写出来吧，感觉不是很难的样子。要写建表，首先就要解析SQL语句了，所以需要先写一个SQL语句解析器。

视图的存储：把SELECT语句存储在以视图名为文件名的txt文件中，查询时拿出其中的SELECT语句作为输入进行查询。

FROM时判断有无视图名或表名。因为没说要做视图的查询，所以就只做表的查询，也就是CSV文件的查询。

用户名和ip作为一个整体来读取，然后再分割为具体的用户名和ip地址来存储在CSV文件中。

才发现没说要做Drop……

### 22:17

终于把step枚举完了。。。累死我了

继续写解析器

## 2020-12-24

明天就检查了。。。

## 0:20
实在是写不动了，先推一下GitHub
